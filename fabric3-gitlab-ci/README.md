# fabric3-gitlab-ci

For use with Gitlab-CI for deploying a docker-compose script to a remote server and automate the start up of the service.  

The script minimally supports two deploy enviroments, but can be easily extended:
- staging
- production

The script will assume there is a pre-built Docker image located at **CI_REGISTRY_IMAGE**:**CI_COMMIT_REF_NAME** and will pull it on the remote server. This Docker image is assumed to be used within the docker-compose script for startup / teardown routine.

You will need to set up CI/CD variables in Gitlab minimally for these:
- **PRODUCTION_SSH_HOST** - The SSH host string for the production server, example ubuntu@172.10.0.100:1234 (user@host:port)
- **PRODUCTION_SSH_KEY** - The RSA private key string generated by ssh-keygen to access the production server via SSH
- **PRODUCTION_SUDO_PASS** - The sudo password for the remote server  

- **STAGING_SSH_HOST** - The SSH host string for the staging server, example ubuntu@172.10.0.100:1234 (user@host:port)
- **STAGING_SSH_KEY** - The RSA private key string generated by ssh-keygen to access the staging server via SSH
- **STAGING_SUDO_PASS** - The sudo password for the remote server

The script also automatically passes CI_REGISTRY_IMAGE and CI_COMMIT_REF_NAME to the deploy environment
to be accessed by the docker-compose script.

All application specific environment variables (secrets such as API keys) should be set up as CI/CD variables with the **APP_** prefix. These variables will be automatically passed to the deployed enviroment by the fabric script.
